{"version":3,"file":"index.js","sources":["../src/caret-position.js","../src/suggestion-item.js","../src/current-word.js","../src/constants.js","../src/suggestion-portal.js","../src/index.js"],"sourcesContent":["// Acquire from http://jsfiddle.net/gliheng/vbucs/12/\nfunction position($node, offsetx, offsety) {\n  offsetx = offsetx || 0\n  offsety = offsety || 0\n\n  let nodeLeft = 0\n  let nodeTop = 0\n  if ($node) {\n    nodeLeft = $node.offsetLeft\n    nodeTop = $node.offsetTop\n  }\n\n  const pos = { left: 0, top: 0, bottom: 0 }\n\n  if (document.selection) {\n    const range = document.selection.createRange()\n    pos.left = range.offsetLeft + offsetx - nodeLeft\n    pos.top = range.offsetTop + offsety - nodeTop\n  } else if (window.getSelection) {\n    const sel = window.getSelection()\n    if (sel.rangeCount === 0) return null\n    const range = sel.getRangeAt(0).cloneRange()\n    try {\n      range.setStart(range.startContainer, range.startOffset - 1)\n    } catch (e) {}\n\n    const rect = range.getBoundingClientRect()\n\n    if (range.endOffset === 0 || range.toString() === '') {\n      // first char of line\n      if (range.startContainer === $node) {\n        // empty div\n        if (range.endOffset === 0) {\n          pos.top = 0\n          pos.left = 0\n        } else {\n          // firefox need this\n          const range2 = range.cloneRange()\n          range2.setStart(range2.startContainer, 0)\n          const rect2 = range2.getBoundingClientRect()\n          pos.left = rect2.left + offsetx - nodeLeft\n          pos.top = rect2.top + rect2.height + offsety - nodeTop\n        }\n      } else {\n        pos.top = range.startContainer.offsetTop\n        pos.left = range.startContainer.offsetLeft\n      }\n    } else {\n      pos.left = rect.left + rect.width + offsetx - nodeLeft\n      pos.top = rect.top + offsety - nodeTop\n    }\n  }\n  return pos\n};\n\nexport default position\n","import React from 'react'\n\nclass SuggestionItem extends React.Component {\n   onClick = (e) => {\n \n    this.props.closePortal()\n\n    const { editor, suggestion, appendSuggestion } = this.props\n    appendSuggestion(suggestion, editor)\n\n    editor.onChange(editor)\n  }\n\n  onMouseEnter = () =>\n    this.props.setSelectedIndex(this.props.index)\n\n  render = () =>\n    <li\n      className={this.props.index === this.props.selectedIndex ? 'selected' : undefined}\n      onClick={this.onClick}\n      onMouseEnter={this.onMouseEnter}\n    >\n      {this.props.suggestion.suggestion}\n    </li>\n}\n\nexport default SuggestionItem\n","function getCurrentWord(text, index, initialIndex) {\n \n  if (text[index] === \" \" || text[index] === undefined) return \"\"\n  if (index < initialIndex) {\n    return getCurrentWord(text, index - 1, initialIndex) + text[index]\n  }\n  if (index > initialIndex) {\n    return text[index] + getCurrentWord(text, index + 1, initialIndex)\n  }\n  return getCurrentWord(text, index - 1, initialIndex) + text[index] + getCurrentWord(text, index + 1, initialIndex)\n  \n}\n\nexport default getCurrentWord\n","export const ESCAPE_KEY = 27\nexport const UP_ARROW_KEY = 38\nexport const DOWN_ARROW_KEY = 40\nexport const ENTER_KEY = 13\nexport const RESULT_SIZE = 5\n","import React from \"react\";\n\nimport { Portal } from \"react-portal\";\nimport position from \"./caret-position\";\nimport SuggestionItem from \"./suggestion-item\";\nimport getCurrentWord from \"./current-word\";\nimport {\n  UP_ARROW_KEY,\n  DOWN_ARROW_KEY,\n  RESULT_SIZE,\n  ESCAPE_KEY,\n  ENTER_KEY\n} from \"./constants\";\nimport ClickOutside from \"react-click-outside\";\n\nclass SuggestionPortal extends React.Component {\n  state = {\n    suggestions: [],\n    filteredSuggestions: []\n  };\n\n  componentDidMount = () => {\n    this.adjustPosition();\n    window.addEventListener(\"resize\", ::this.adjustPosition);\n    window.addEventListener(\"scroll\", ::this.adjustPosition);\n  };\n\n  componentDidUpdate = () => {\n    this.adjustPosition();\n  };\n\n  componentWillUnmount = () => {\n    window.removeEventListener(\"resize\", ::this.adjustPosition);\n    window.removeEventListener(\"scroll\", ::this.adjustPosition);\n  };\n\n  constructor(props) {\n    super();\n    this.isOpen = false;\n    this.justOpened = false;\n    this.portalContainer = React.createRef();\n    this.alignTop = !!props.alignTop;\n    props.callback.onKeyDown = this.onKeyDown;\n    props.callback.onKeyUp = this.onKeyUp;\n    props.callback.onEnter = props.onEnter;\n    props.callback.onUpdatedSelections = this.onUpdatedSelections;\n    console.log(\"This is the data passed to the internal \", props);\n\n    this.selectedIndex = 0;\n    if (typeof props.suggestions === \"function\") {\n      props.callback.suggestion = undefined;\n    } else {\n      this.state.filteredSuggestions = props.suggestions.slice(\n        0,\n        props.resultSize ? props.resultSize : RESULT_SIZE\n      );\n      props.callback.suggestion = this.state.filteredSuggestions[\n        this.selectedIndex\n      ];\n    }\n  }\n\n  /* Add new \n    Trigger update new suggestions from parent\n  */\n  onUpdatedSelections = suggestions => {\n    this.state.suggestions = suggestions;\n  };\n\n  setCallbackSuggestion = () => {\n    if (this.state.filteredSuggestions.length) {\n      this.props.callback.suggestion = this.state.filteredSuggestions[\n        this.selectedIndex\n      ];\n    } else {\n      this.props.callback.suggestion = undefined;\n    }\n  };\n\n  setFilteredSuggestions = filteredSuggestions => {\n    this.setState(\n      {\n        filteredSuggestions\n      },\n      this.setCallbackSuggestion\n    );\n  };\n\n  onKeyUp = (e, change, next) => {\n    const match = this.matchCapture();\n    if (match) {\n      if (\n        e.keyCode !== DOWN_ARROW_KEY &&\n        e.keyCode !== UP_ARROW_KEY &&\n        e.keyCode !== ENTER_KEY &&\n        e.keyCode !== ESCAPE_KEY\n      ) {\n        this.selectedIndex = 0;\n        const newFilteredSuggestions = this.getFilteredSuggestions(e.key);\n\n        if (typeof newFilteredSuggestions.then === \"function\") {\n          newFilteredSuggestions\n            .then(newFilteredSuggestions => {\n              this.setFilteredSuggestions(newFilteredSuggestions);\n            })\n            .catch(() => {\n              this.setFilteredSuggestions([]);\n            });\n        } else {\n          this.setFilteredSuggestions(newFilteredSuggestions);\n        }\n      }\n    }\n\n    next();\n  };\n\n  onKeyDown = (e, editor, next) => {\n    const match = this.matchCapture();\n\n    if (match) {\n      const { filteredSuggestions } = this.state;\n      if (filteredSuggestions.length > 0) {\n        // Prevent default return/enter key press when portal is open\n        if (e.keyCode === ESCAPE_KEY) {\n          this.hidePortal();\n          return false;\n        } else if (e.keyCode === ENTER_KEY) {\n          e.preventDefault();\n          this.closePortal();\n          this.selectedIndex = this.selectedIndex || 0;\n          this.setCallbackSuggestion();\n\n          // Handle enter\n          if (\n            this.props.callback.onEnter &&\n            this.props.callback.suggestion !== undefined\n          ) {\n            this.props.callback.onEnter(this.props.callback.suggestion, editor);\n            editor.onChange(editor);\n            return false;\n          }\n        } else if (e.keyCode === DOWN_ARROW_KEY) {\n          e.preventDefault();\n          if (this.selectedIndex + 1 === filteredSuggestions.length) {\n            this.selectedIndex = -1;\n          }\n          this.selectedIndex = (this.selectedIndex || 0) + 1;\n          this.setCallbackSuggestion();\n          this.forceUpdate();\n          return false;\n        } else if (e.keyCode === UP_ARROW_KEY) {\n          e.preventDefault();\n          if (this.selectedIndex === 0) {\n            this.selectedIndex = filteredSuggestions.length;\n          }\n          this.selectedIndex =\n            (this.selectedIndex || filteredSuggestions.length) - 1;\n          this.setCallbackSuggestion();\n          this.forceUpdate();\n          return false;\n        }\n      }\n    }\n\n    next();\n  };\n\n  matchCapture = () => {\n    const { value, capture } = this.props;\n\n    if (!value.selection.anchor.key) return \"\";\n\n    const { anchorText, selection } = value;\n    const { offset } = selection.anchor;\n\n    const currentWord = getCurrentWord(anchorText.text, offset - 1, offset - 1);\n\n    const matchText = this.getMatchText(currentWord, capture);\n\n    return matchText;\n  };\n\n  getMatchText = (text, trigger) => {\n    const matchArr = text.match(trigger);\n\n    if (matchArr) {\n      return matchArr[0].toLowerCase();\n    }\n\n    return undefined;\n  };\n\n  getFilteredSuggestions = () => {\n    const { value, capture, resultSize } = this.props;\n    /* Load the suggstions from the state not from the props \n    for the dynamic suggestions loading */\n    const { suggestions } = this.state;\n\n    if (!value.selection.anchor.key) return [];\n\n    const { anchorText, selection } = value;\n    const { offset } = selection.anchor;\n\n    const currentWord = getCurrentWord(anchorText.text, offset - 1, offset - 1);\n\n    let matchText = this.getMatchText(currentWord, capture);\n    matchText = matchText.slice(1, matchText.length);\n\n    if (typeof suggestions === \"function\") {\n      return suggestions(matchText);\n    } else if (matchText) {\n      return suggestions\n        .filter(\n          suggestion => suggestion.key.toLowerCase().indexOf(matchText) !== -1\n        )\n        .slice(0, resultSize ? resultSize : RESULT_SIZE);\n    } else {\n      return suggestions;\n    }\n  };\n\n  adjustPosition = () => {\n    if (!this.portalContainer.current) return;\n\n    const match = this.matchCapture();\n\n    if (match) {\n      this.showPortal();\n      const rect = position();\n      if (rect) {\n        this.portalContainer.current.style.display = \"block\";\n        this.portalContainer.current.style.opacity = 1;\n        if (this.alignTop) {\n          let height = this.portalContainer.current.clientHeight;\n          this.portalContainer.current.style.top = `${rect.top +\n            window.scrollY -\n            height -\n            14}px`; // eslint-disable-line no-mixed-operators\n        } else {\n          this.portalContainer.current.style.top = `${rect.top +\n            window.scrollY}px`; // eslint-disable-line no-mixed-operators\n        }\n\n        this.portalContainer.current.style.left = `${rect.left +\n          window.scrollX}px`; // eslint-disable-line no-mixed-operators\n      }\n    } else if (match === undefined) {\n      this.hidePortal();\n      return;\n    }\n  };\n\n  showPortal = rect => {\n    if (!this.isOpen) {\n      this.isOpen = true;\n      if (!this.justOpened) {\n        this.justOpened = true;\n        setTimeout(() => {\n          this.justOpened = false;\n        }, 100);\n      }\n      this.props.onOpen && this.props.onOpen();\n    }\n  };\n\n  hidePortal = () => {\n    if (this.isOpen) {\n      this.portalContainer.current.removeAttribute(\"style\");\n      this.isOpen = false;\n      this.props.onClose && this.props.onClose();\n    }\n  };\n\n  closePortal = () => {\n    if (!this.portalContainer.current) return;\n\n    const match = this.matchCapture();\n    this.props.onClose && this.props.onClose();\n    if (!match) {\n      this.hidePortal();\n      return;\n    }\n  };\n\n  clickOutside = () => {\n    if (this.isOpen) {\n      if (!this.justOpened) {\n        this.hidePortal();\n      }\n    }\n  };\n\n  setSelectedIndex = selectedIndex => {\n    this.selectedIndex = selectedIndex;\n    this.forceUpdate();\n  };\n\n  render = () => {\n    const { filteredSuggestions } = this.state;\n\n    return (\n      <Portal isOpened node={document && document.body}>\n        <ClickOutside onClickOutside={this.clickOutside}>\n          <div className=\"suggestion-portal\" ref={this.portalContainer}>\n            <ul>\n              {filteredSuggestions.map((suggestion, index) => (\n                <SuggestionItem\n                  key={suggestion.key}\n                  index={index}\n                  suggestion={suggestion}\n                  selectedIndex={this.selectedIndex}\n                  setSelectedIndex={this.setSelectedIndex}\n                  appendSuggestion={this.props.callback.onEnter}\n                  closePortal={this.closePortal}\n                  editor={this.props.callback.editor}\n                />\n              ))}\n            </ul>\n          </div>\n        </ClickOutside>\n      </Portal>\n    );\n  };\n}\n\nexport default SuggestionPortal;\n","import React from 'react'\nimport Portal from './suggestion-portal'\n\nfunction SuggestionsPlugin(opts) {\n\n  const callback = {}\n\n  function onKeyDown(e, editor, next) {\n    callback.editor = editor\n\n    if (callback.onKeyDown) {\n       return callback.onKeyDown(e, editor, next)\n    }\n\n    next();\n  }\n\n  function onKeyUp(e, editor, next) {\n    callback.editor = editor\n\n    if (callback.onKeyUp) {\n       return callback.onKeyUp(e, editor, next)\n    }\n\n    next();\n  }\n  \n\n  return {\n    onKeyDown,\n    onKeyUp,\n    SuggestionPortal: React.forwardRef((props, ref) => {\n      return (\n        <Portal\n          {...props}\n          {...opts}\n          ref={ref}\n          callback={callback}\n        />\n      )\n    })\n\n  }\n}\n\nexport default SuggestionsPlugin\n"],"names":["position","$node","offsetx","offsety","nodeLeft","nodeTop","offsetLeft","offsetTop","pos","left","top","bottom","document","selection","range","createRange","window","getSelection","sel","rangeCount","getRangeAt","cloneRange","setStart","startContainer","startOffset","e","rect","getBoundingClientRect","endOffset","toString","range2","rect2","height","width","SuggestionItem","onClick","props","closePortal","editor","suggestion","appendSuggestion","onChange","onMouseEnter","setSelectedIndex","index","render","selectedIndex","undefined","React","Component","getCurrentWord","text","initialIndex","ESCAPE_KEY","UP_ARROW_KEY","DOWN_ARROW_KEY","ENTER_KEY","RESULT_SIZE","SuggestionPortal","state","componentDidMount","adjustPosition","addEventListener","componentDidUpdate","componentWillUnmount","removeEventListener","onUpdatedSelections","suggestions","setCallbackSuggestion","filteredSuggestions","length","callback","setFilteredSuggestions","setState","onKeyUp","change","next","match","matchCapture","keyCode","newFilteredSuggestions","getFilteredSuggestions","key","then","catch","onKeyDown","hidePortal","preventDefault","onEnter","forceUpdate","value","capture","anchor","anchorText","offset","currentWord","matchText","getMatchText","trigger","matchArr","toLowerCase","resultSize","slice","filter","indexOf","portalContainer","current","showPortal","style","display","opacity","alignTop","clientHeight","scrollY","scrollX","isOpen","justOpened","onOpen","removeAttribute","onClose","clickOutside","body","map","createRef","log","SuggestionsPlugin","opts","forwardRef","ref","Portal"],"mappings":"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"}